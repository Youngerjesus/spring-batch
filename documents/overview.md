# 개요 및 아키텍처 

## 스프링 배치의 탄생 

- 자바 진영에서는 배치 기술이 없었다.
  - 그래서 spring source (현재 pivotal) 과 Accenture (경영 컨설팅) 이 합쳐서 스프링 배치를 만듦.
  - Accenture 는 배치 아키텍처를 구현하면서 쌓은 기술과 노하우가 있었고 SpringSource 는 기술적 기반이 있었음.

## 배치 핵심 패턴 

- Read
  - 데이터베이스, 파일, 큐에서 다량의 데이터를 조회한다.
- Process
  - 특정 방법으로 데이터를 가공한다.
- Write
  - 데이터를 수정된 양식으로 다시 저장한다.
- **(읽고 가공하고 저장하는게 배치의 핵심 패턴 ETL 과 유사. 스프링 배치는 이 세가지 항목이 잘 설계되었음.)**

## 배치 사용 시나리오

- 배치 프로세스를 주기적으로 커밋
  - 대용량의 데이터를 처리한다고 했을 때 한번에 이를 다하지 않는다. (여러 문제가 있겠지. 메모리 포함해)
  - 그러므로 데이터를 쪼개서 처리하고 커밋 해야한다.
- 동시 다발적인 Job 의 배치 처리, 대용량 병렬 처리
  - Job 도 동시에 실행시킬 수 있고, Job 간 간섭이 없도록 지원한다.
  - 더 빠른 처리를 위해서 병렬 처리도 지원한다.
- 실패 후 수동 또는 스케줄링에 의한 재시작
- 의존관계가 있는 step 여러 개를 순차적으로 처리
  - Job 안에는 Step 이 여러개 있다. 이 Step 들을 순차적으로 실행하도록 지원한다.
- 조건적 Flow 를 통해 체계적이고 유연한 배치 모델 구성
  - 경우에 따라서는 순차적 처리가 아닌 조건적인 처리가 필요할 수도 있다. 이게 Flow 다. (조건에 따라서 처리하는.)
- 반복, 재시도, Skip 처리를 지원한다.
  - 배치는 반복적으로 실행하고 재시도도 지원해야한다. 그리고 필요하다면 skip 할 수도 있어야한다.

## 배치 아키텍처 

![](./images/batch_architecture.png)

- 총 3개의 레이어가 있다.
- Application
  - 스프링 배치 프레임워크를 통해서 개발자가 만든 Job 과 코드들을 말한다.
  - 개발자는 로직에만 집중하면됨.
- Batch Core
  - Job 을 실행하고, 모니터링하고, 관리하는 API 로 구성되어있다.
  - JobLauncher, Job, Step, Flow 등이 속한다.
- Batch Infrastructure
  - Application, core 모두 배치 인프라스트럭처에서 실행된다.
  - Job 의 실행과 흐름과 처리를 위한 인프라를 지원한다.
  - Reader, Writer, Processor, Skip, Retry 등이 속한다.
  - Core 는 Job 을 구성하는데 신경쓴다면, Infra 는 Job 을 실행하고 처리를 담당한다. 
